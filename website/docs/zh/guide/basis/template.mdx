# é…ç½®HTMLæ¨¡ç‰ˆ

åœ¨æ„å»ºçš„è¿‡ç¨‹ä¸­ï¼ŒEMP ä¼šåŸºäº HTML æ¨¡æ¿æ–‡ä»¶å’Œæ¨¡æ¿å‚æ•°è¿›è¡Œç¼–è¯‘ï¼Œç”Ÿæˆä¸€ä¸ªç±»ä¼¼äº SPA çš„æ„å»ºäº§ç‰©ã€‚

EMP æä¾›äº†ä¸€äº›é…ç½®é¡¹æ¥å¯¹ HTML æ¨¡æ¿è¿›è¡Œè®¾ç½®ã€‚é€šè¿‡æœ¬ç« èŠ‚ä½ å¯ä»¥äº†è§£åˆ°è¿™äº›é…ç½®é¡¹çš„åŸºæœ¬ç”¨æ³•ã€‚

## è®¾ç½®æ¨¡æ¿æ–‡ä»¶

EMP é»˜è®¤ä½¿ç”¨è‡ªå¸¦çš„ HTML æ¨¡æ¿æ–‡ä»¶ï¼Œå½“ç„¶, EMP å…è®¸æ‚¨æŒ‡å®šä¸€ä¸ª HTML æ–‡ä»¶ä½œä¸ºæ¨¡æ¿æ–‡ä»¶ä»£æ›¿é»˜è®¤çš„ HTML æ¨¡æ¿æ–‡ä»¶è¿›è¡Œäº§ç‰©æ„å»ºè¿è¡Œï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `html.template` é…ç½®é¡¹æ¥è®¾ç½®å®ƒï¼š

```js title="emp.config.js"
export default defineConfig(store => {
  return {
    html: {
      template: './index.html',
    },
  }
})
```

ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¼šæŸ¥æ‰¾å½“å‰ `emp.config.js` åŒä¸€çº§ç›®å½•ä¸‹çš„ `index.html` ä½œä¸ºæ¨¡æ¿æ–‡ä»¶ã€‚

:::warning âš ï¸ æ³¨æ„
é…ç½®é¡¹ `html.template` çš„å€¼åªèƒ½æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œè¯·å‹¿ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º `src/index.html`ã€‚
:::

### æ¨¡æ¿æ–‡ä»¶ç¤ºä¾‹

ä¸ºäº†æ‚¨çš„æ­£å¸¸ä½¿ç”¨ï¼Œæ‚¨åº”è¯¥å°†HTMLæ¨¡æ¿è®¾ç½®å®Œæ•´ï¼Œä¸€ä¸ªæœ€å°çš„æ¨¡æ¿æ–‡ä»¶åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š

```html title="min.html"
<!DOCTYPE html>
<html lang="<%= htmlWebpackPlugin.options.lang %>">

<head>
  <title>
    <%= htmlWebpackPlugin.options.title %>
  </title>
</head>

<body>
  <div id="emp-root"></div>
</body>

</html>
```

å½“ç„¶ï¼Œæ‚¨ä¹Ÿå¯ä»¥è¿›è¡Œåœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œè¿›è¡Œå…¼å®¹æ€§ç­‰ç›¸å…³å¤„ç†ï¼Œå®Œæ•´çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š

```html title="index.html"
<!DOCTYPE html>
<!--[if lt IE 7 ]> <html lang="en" class="ie6" <% if(htmlWebpackPlugin.files.manifest) { %> manifest="<%= htmlWebpackPlugin.files.manifest %>"<% } %>> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="ie7" <% if(htmlWebpackPlugin.files.manifest) { %> manifest="<%= htmlWebpackPlugin.files.manifest %>"<% } %>> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="ie8" <% if(htmlWebpackPlugin.files.manifest) { %> manifest="<%= htmlWebpackPlugin.files.manifest %>"<% } %>> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="ie9" <% if(htmlWebpackPlugin.files.manifest) { %> manifest="<%= htmlWebpackPlugin.files.manifest %>"<% } %>> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="" <% if(htmlWebpackPlugin.files.manifest) { %> manifest="<%= htmlWebpackPlugin.files.manifest %>"<% } %>> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title><%= htmlWebpackPlugin.options.title || 'Webpack App'%></title>

  <% if (htmlWebpackPlugin.files.favicon) { %>
  <link rel="shortcut icon" href="<%= htmlWebpackPlugin.files.favicon%>">
  <% } %>
  <% if (htmlWebpackPlugin.options.mobile) { %>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <% } %>

  <% for (var css in htmlWebpackPlugin.files.css) { %>
  <link href="<%= htmlWebpackPlugin.files.css[css] %>" rel="stylesheet">
  <% } %>
</head>
<body>
<% if (htmlWebpackPlugin.options.unsupportedBrowser) { %>
<style>.unsupported-browser { display: none; }</style>
<div class="unsupported-browser">
  Sorry, your browser is not supported.  Please upgrade to
  the latest version or switch your browser to use this site.
  See <a href="http://outdatedbrowser.com/">outdatedbrowser.com</a>
  for options.
</div>
<% } %>

<% if (htmlWebpackPlugin.options.appMountId) { %>
<div id="<%= htmlWebpackPlugin.options.appMountId%>"></div>
<% } %>

<% if (htmlWebpackPlugin.options.appMountIds && htmlWebpackPlugin.options.appMountIds.length > 0) { %>
<% for (var index in htmlWebpackPlugin.options.appMountIds) { %>
<div id="<%= htmlWebpackPlugin.options.appMountIds[index]%>"></div>
<% } %>
<% } %>

<% if (htmlWebpackPlugin.options.window) { %>
<script>
  <% for (var varName in htmlWebpackPlugin.options.window) { %>
    window['<%=varName%>'] = <%= JSON.stringify(htmlWebpackPlugin.options.window[varName]) %>;
  <% } %>
</script>
<% } %>

<% for (var chunk in htmlWebpackPlugin.files.chunks) { %>
<script src="<%= htmlWebpackPlugin.files.chunks[chunk].entry %>"></script>
<% } %>

<% if (htmlWebpackPlugin.options.devServer) { %>
<script src="<%= htmlWebpackPlugin.options.devServer%>/webpack-dev-server.js"></script>
<% } %>

<% if (htmlWebpackPlugin.options.googleAnalytics) { %>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');


  <% if (htmlWebpackPlugin.options.googleAnalytics.trackingId) { %>
    ga('create', '<%= htmlWebpackPlugin.options.googleAnalytics.trackingId%>', 'auto');
    <% } else { throw new Error("html-webpack-template requires googleAnalytics.trackingId config"); }%>

  <% if (htmlWebpackPlugin.options.googleAnalytics.pageViewOnLoad) { %>
    ga('send', 'pageview');
  <% } %>
</script>
<% } %>
</body>
</html>
```

## è®¾ç½®é¡µé¢æ ‡é¢˜

å½“æˆ‘ä»¬åªéœ€è¦æ”¹åŠ¨é¡µé¢æ ‡é¢˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ `html.title` é…ç½®é¡¹æ¥è®¾ç½®å®ƒï¼š

```js title="emp.config.js"
export default defineConfig(store => {
  return {
    html: {
      title: 'EMP3 666',
    },
  }
})
```

ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¼šå°† HTML æ¨¡æ¿æ–‡ä»¶ä¸­çš„`<title>` æ ‡ç­¾è®¾ç½®ä¸º `EMP3 666`ã€‚

## è®¾ç½®é¡µé¢è¯­è¨€

å½“æˆ‘ä»¬åªéœ€è¦æ”¹åŠ¨é¡µé¢è¯­è¨€æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ `html.lang` é…ç½®é¡¹æ¥è®¾ç½®å®ƒï¼š

```js title="emp.config.js"
export default defineConfig(store => {
  return {
    html: {
      lang: 'en-US',
    },
  }
})
```

ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¼šå°† HTML æ¨¡æ¿æ–‡ä»¶ä¸­çš„`<lang>` æ ‡ç­¾è®¾ç½®ä¸º `en-US`ã€‚

## è®¾ç½®é¡µé¢metaæ ‡ç­¾

å½“æˆ‘ä»¬åªéœ€è¦è®¾ç½®metaæ ‡ç­¾æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ `html.meta` é…ç½®é¡¹æ¥è®¾ç½®å®ƒï¼š

```js title="emp.config.js"
export default defineConfig(store => {
  return {
    html: {
      meta: {
        viewport: 'width=device-width, initial-scale=1.0',
      },
    },
  }
})
```

ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¼šå°† HTML æ¨¡æ¿æ–‡ä»¶ä¸­çš„`<meta>` æ ‡ç­¾è®¾ç½®ç›¸å…³è§†å£å±æ€§ã€‚

## è®¾ç½®é¡µé¢å›¾æ ‡

å½“æˆ‘ä»¬åªéœ€è¦è®¾ç½®é¡µé¢å›¾æ ‡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ `html.favicon` é…ç½®é¡¹æ¥è®¾ç½®å®ƒï¼š

```js title="emp.config.js"
export default defineConfig(store => {
  return {
    html: {
      favicon: './favicon.ico',
    },
  }
})
```

ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¼šæŸ¥æ‰¾å½“å‰ `emp.config.js` åŒä¸€çº§ç›®å½•ä¸‹çš„ `favicon.ico` ä½œä¸ºé¡µé¢å›¾æ ‡ã€‚

:::warning âš ï¸ æ³¨æ„
é…ç½®é¡¹ `html.favicon` çš„å€¼åªèƒ½æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œè¯·å‹¿ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º `src/favicon.ico`ã€‚
:::

## è®¾ç½®æ¨¡æ¿å‚æ•°

:::warning âš ï¸ æ³¨æ„
ä½¿ç”¨æ¨¡æ¿å‚æ•°éœ€è¦æ‚¨åœ¨é¡¹ç›®ä¸­æ­£ç¡®åµŒå…¥äº†æ¨¡æ¿å‚æ•°ï¼Œæˆ–è€…ä½¿ç”¨äº†é»˜è®¤çš„æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ¨¡æ¿æ¸²æŸ“å¼•æ“ä¸º `Lodash Template`ã€‚
:::

åœ¨ HTML æ¨¡æ¿ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸°å¯Œçš„æ¨¡æ¿å‚æ•°ç”¨äºHTMLæ¨¡æ¿ä¸­ï¼ŒEMPé»˜è®¤æ³¨å…¥çš„å‚æ•°æœ‰ï¼š
```ts 
type DefaultParameters = {
  mountId: string; // å¯¹åº” html.mountId é…ç½®
  entryName: string; // å…¥å£åç§°
  assetPrefix: string; // å¯¹åº” dev.assetPrefix å’Œ output.assetPrefix é…ç½®
  compilation: Compilation; // å¯¹åº” Rspack çš„ compilation å¯¹è±¡
  // htmlWebpackPlugin å†…ç½®çš„å‚æ•°
  // è¯¦è§ https://github.com/jantimon/html-webpack-plugin
  htmlWebpackPlugin: {
    tags: object;
    files: object;
    options: object;
  };
};
```

æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡ `html.templateParameters` é…ç½®é¡¹æ¥ä¼ å…¥è‡ªå®šä¹‰çš„æ¨¡æ¿å‚æ•°ï¼š

```js title="emp.config.js"
export default defineConfig(store => {
  return {
    html: {
      templateParameters: {
        title: 'EMP3 wow',
      },
    },
  }
})
```

æ¥ä¸‹æ¥ï¼Œæ‚¨å¯ä»¥åœ¨ HTML æ¨¡æ¿ä¸­ï¼Œé€šè¿‡ `<%= text %>` æ¥è¯»å–å‚æ•°ï¼š

```html 
<div><%= text %>!</div>
```

æœ€ç»ˆç»è¿‡ EMP ç¼–è¯‘åï¼Œå®ƒçš„ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```html
<div>EMP3 wow!</div>
```

## æ¨¡æ¿å¼•æ“

EMP å†…ç½®äº†ä¸‰å¥—æ¨¡æ¿å¼•æ“ï¼Œå¯ç”¨äºåŠ¨æ€åŒ–ç”ŸæˆHTMLå†…å®¹ï¼Œé»˜è®¤ä½¿ç”¨æœ€åŸºç¡€çš„ `Lodash Template` ä½œä¸ºæ¨¡æ¿å¼•æ“ã€‚

### Lodash Template

å½“æ¨¡æ¿æ–‡ä»¶çš„åç¼€ä¸º `.html` æ—¶ï¼ŒEMP ä¼šä½¿ç”¨ `Lodash Template` å¯¹æ¨¡æ¿è¿›è¡Œç¼–è¯‘ã€‚

ä¾‹å¦‚ï¼Œåœ¨æ¨¡æ¿ä¸­å®šä¹‰ä¸€ä¸ª text å‚æ•°ï¼Œå€¼ä¸º 'EMP3 wow'ï¼Œåœ¨æ„å»ºæ—¶ä¼šè‡ªåŠ¨å°† `<%= text %>` æ›¿æ¢ä¸ºå¯¹åº”çš„å€¼ã€‚

```html 
<!-- è¾“å…¥ -->
<div><%= text %>!</div>

<!-- è¾“å‡º -->
<div>EMP3 wow!</div>
```

:::tip ğŸ’¡ TIP 
æ‚¨å¯ä»¥é˜…è¯» [Lodash Template](https://lodashjs.com/docs/lodash.template) æ¥äº†è§£å®Œæ•´ç”¨æ³•ã€‚
:::

### EJSæ–‡ä»¶

å½“æ¨¡æ¿æ–‡ä»¶çš„åç¼€ä¸º `.ejs` æ—¶ï¼ŒEMP ä¼šä½¿ç”¨ `EJS` æ¨¡æ¿å¼•æ“å¯¹æ¨¡æ¿è¿›è¡Œç¼–è¯‘ã€‚EJS æ˜¯ä¸€å¥—ç®€å•çš„æ¨¡æ¿è¯­è¨€ï¼Œæ”¯æŒç›´æ¥åœ¨æ ‡ç­¾å†…ä¹¦å†™ç®€å•ã€ç›´ç™½çš„ JavaScript ä»£ç ï¼Œå¹¶é€šè¿‡ JavaScript è¾“å‡ºæœ€ç»ˆæ‰€éœ€çš„ HTMLã€‚

ä¾‹å¦‚ï¼Œä½ å¯ä»¥å…ˆé€šè¿‡ `html.template` é…ç½®é¡¹æ¥å¼•ç”¨ä¸€ä¸ª .ejs æ¨¡æ¿æ–‡ä»¶ï¼š

```js title="emp.config.js"
export default defineConfig(store => {
  return {
    html: {
      template: './index.ejs',
    },
  }
})
```

æ¥ç€åœ¨æ¨¡æ¿ä¸­å®šä¹‰ä¸€ä¸ª `user` å‚æ•°ï¼Œå€¼ä¸º `{ name: 'Youli' }`ã€‚åœ¨æ„å»ºæ—¶ï¼Œä¼šè‡ªåŠ¨å°† `<%= user.name %>` æ›¿æ¢ä¸ºå¯¹åº”çš„å€¼ã€‚

```html 
<!-- è¾“å…¥  -->
<% if (user) { %>
<h2><%= user.name %></h2>
<% } %>

<!-- è¾“å‡º -->
<h2>Youli</h2>
```

:::tip ğŸ’¡ TIP 
æ‚¨å¯ä»¥é˜…è¯» [EJS](https://ejs.co/) æ¥äº†è§£å®Œæ•´ç”¨æ³•ã€‚
:::

### Pug

EMP é€šè¿‡ Pug æ’ä»¶æ¥æ”¯æŒ Pug æ¨¡æ¿å¼•æ“ï¼Œè¯·é˜…è¯» [Pug æ’ä»¶æ–‡æ¡£](https://rsbuild.dev/zh/plugins/list/plugin-pug) æ¥äº†è§£ç”¨æ³•ã€‚

## æ³¨å…¥æ ‡ç­¾

é€šè¿‡é…ç½® `html.tags` é€‰é¡¹å¯ä»¥åœ¨æœ€ç»ˆç”Ÿæˆçš„ HTML äº§ç‰©ä¸­æ’å…¥ä»»æ„æ ‡ç­¾ã€‚

:::details ğŸ› ï¸ ä½¿ç”¨åœºæ™¯
å‰ç«¯åº”ç”¨çš„äº§ç‰©æœ€ç»ˆéƒ½ä¼šç›´æ¥æˆ–é—´æ¥åœ°è¢« HTML å…¥å£å¼•ç”¨ï¼Œä½†å¤§å¤šæ•°æ—¶å€™ç›´æ¥å‘ HTML æ³¨å…¥æ ‡ç­¾éƒ½å¹¶éé¦–é€‰ã€‚
:::

æ¨¡ç‰ˆæ–‡ä»¶ä¸­å¯ä»¥é€šè¿‡ `htmlWebpackPlugin.tags` å˜é‡æ¥è®¿é—®éœ€è¦æœ€ç»ˆæ³¨å…¥åˆ° HTML çš„æ‰€æœ‰æ ‡ç­¾ï¼š

```html 
<html>
  <head>
    <%= htmlWebpackPlugin.tags.headTags %>
  </head>
  <body>
    <%= htmlWebpackPlugin.tags.bodyTags %>
  </body>
</html>
```

`html.tags` çš„ä½œç”¨å°±æ˜¯è°ƒæ•´è¿™äº›æ¨¡æ¿å˜é‡è¿›è€Œä¿®æ”¹ HTMLï¼Œé…ç½®çš„å…·ä½“å®šä¹‰å‚è€ƒ [API References](https://www.baidu.com/)ã€‚

### å¯¹è±¡ç”¨æ³•

```js title="emp.config.js"
export default defineConfig(store => {
  return {
    html: {
      tags: {
        headTags: [
          {tag: 'script', attrs: {src: 'a.js'}},
          {tag: 'script', attrs: {src: 'b.js'}},
          {tag: 'link', attrs: {href: 'style.css', rel: 'stylesheet'}},
          {tag: 'link', attrs: {href: 'page.css', rel: 'stylesheet'}, publicPath: false},
          {tag: 'meta', attrs: {name: 'referrer', content: 'origin'}},
        ],
        bodyTags: [{tag: 'script', attrs: {src: 'c.js'}}],
      },
    },
  }
})
```

æ ‡ç­¾æœ€ç»ˆçš„æ’å…¥ä½ç½®ç”± `headTags` å’Œ `bodyTags` é€‰é¡¹å†³å®šï¼Œä¸¤ä¸ªé…ç½®ç›¸åŒçš„å…ƒç´ å°†è¢«æ’å…¥åˆ°ç›¸åŒåŒºåŸŸï¼Œå¹¶ä¸”ç»´æŒå½¼æ­¤ä¹‹é—´çš„ç›¸å¯¹ä½ç½®ã€‚

æ ‡ç­¾é»˜è®¤ä¼šå¯ç”¨ `publicPath` é…ç½®ï¼Œå³ä¼šå°† `output.assetPrefix` çš„å€¼æ‹¼æ¥åˆ° `script` æ ‡ç­¾çš„ `src` ç­‰è¡¨ç¤ºè·¯å¾„çš„å±æ€§ä¸Šã€‚

æ‰€ä»¥ä»¥ä¸Šé…ç½®æ„å»ºå‡ºçš„ HTML äº§ç‰©å°†ä¼šç±»ä¼¼ï¼š

```html 
<html>
  <head>
    <script src="https://example.com/b.js"></script>
    <link href="https://example.com/style.css" rel="stylesheet" />
    <link href="page.css" rel="stylesheet" />
    <!-- some other headTags... -->
    <script src="https://example.com/a.js"></script>
    <meta name="referrer" content="origin" />
  </head>
  <body>
    <!-- some other bodyTags... -->
    <script src="https://example.com/c.js"></script>
  </body>
</html>
```

### å‡½æ•°ç”¨æ³•

html.tags ä¹Ÿæ”¯æŒä¼ å…¥å›è°ƒå‡½æ•°ï¼Œå¸¸ç”¨äºä¿®æ”¹æ ‡ç­¾åˆ—è¡¨æˆ–æ˜¯åœ¨æ’å…¥æ ‡ç­¾çš„åŒæ—¶ç¡®ä¿å…¶ç›¸å¯¹ä½ç½®ã€‚

```js title="emp.config.js"
export default defineConfig(store => {
  return {
    html: {
      tags: {
        headTags: [
          (tags) => {
            tags.splice(0, 1);
          },
          { tag: 'script', attrs: { src: 'a.js' }},
          { tag: 'script', attrs: { src: 'b.js' }},
          { tag: 'script', attrs: { src: 'c.js' } },
          (tags) => [...tags, { tag: 'script', attrs: { src: 'd.js' } }],
        ],
        bodyTags: [],
      },
    },
  }
})
```

æœ€ç»ˆäº§ç‰©å°†ä¼šç±»ä¼¼ï¼š

```html 
<html>
  <head>
    <!-- some other headTags... -->
    <script src="https://example.com/c.js"></script>
    <script src="https://example.com/d.js"></script>
    <script src="https://example.com/a.js"></script>
  </head>
  <body>
  </body>
</html>
```
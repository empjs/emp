import Preparation from '../../shared/preparation.md'
import { Tabs, Tab, PackageManagerTabs } from '@theme';

# React Multi Version

demoé¡¹ç›®ä»“åº“ `emp`:

```bash
git clone https://github.com/empjs/emp
```

:::danger ğŸš¨ å¯èƒ½é‡åˆ°çš„é”™è¯¯
å¦‚æœæ‚¨æ— æ³•æ‹‰å–é¡¹ç›®è‡³æœ¬åœ°ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œç¯å¢ƒæˆ–ä»£ç†è®¾ç½®æ˜¯å¦å¯ä»¥è®¿é—®githubï¼Œå¦‚æœä»ä¸èƒ½è§£å†³ï¼Œè¯·è”ç³»æˆ‘ä»¬ã€‚
:::

åœ¨æ‹‰å–å®Œæˆä»£ç åï¼Œæˆ‘ä»¬è¿›å…¥ä»£ç çš„æ ¹ç›®å½•ï¼Œå®‰è£…é¡¹ç›®ä¾èµ–ï¼Œæ¨èä½¿ç”¨`PNPM`è¿›è¡Œå®‰è£…ï¼š

<PackageManagerTabs command="install" />

å®‰è£…å®Œä¾èµ–åï¼Œè¿è¡Œ `demos/react16_18/react-16-app` ç¤ºä¾‹é¡¹ç›®ã€‚

## è¿è¡Œç¤ºä¾‹é¡¹ç›®

:::warning âš ï¸ æ³¨æ„
åœ¨è¿è¡Œç¤ºä¾‹é¡¹ç›®ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²ç»å®Œæˆäº†å‰æœŸå‡†å¤‡ï¼Œå¹¶å½“å‰ç›®å½•å¤„äº`emp`ä»“åº“çš„æ ¹ç›®å½•ä¸‹ã€‚
:::

### mf-host

é¦–å…ˆè¿›å…¥ç¤ºä¾‹é¡¹ç›®çš„æ ¹ç›®å½•ï¼š

```bash
cd demos/react16_18/react-16-app
```

ç„¶åè¿è¡Œä»£ç ï¼š
<PackageManagerTabs command="dev" />

è¿è¡ŒæˆåŠŸåï¼Œæ‚¨å¯ä»¥è®¿é—®`http://localhost:4002/`è¿›è¡ŒæŸ¥çœ‹ã€‚


## æ¼”ç¤ºæ•ˆæœ

å½“æ‚¨çš„ä»£ç è¿è¡ŒæˆåŠŸä¹‹åï¼Œå®ƒåº”è¯¥æ˜¯è¿™æ ·å­çš„ğŸ¤©ï¼š<a target='_blank' href='https://emp-demo-react16and18.pages.dev/'>è®¿é—®é“¾æ¥</a>

<iframe src="https://emp-demo-react16and18.pages.dev/"
  style={{width: '100%', height: '450px', border: `20px solid #aaa`, borderRadius: '4px', overflow: 'hidden'}}
  title="mf-host"
></iframe>

## é¡¹ç›®é…ç½®

```ts title="emp.config.ts"
import {defineConfig} from '@empjs/cli'
import pluginReact from '@empjs/plugin-react'
import {pluginRspackEmpShare} from '@empjs/share'
//
export default defineConfig((store) => {
  // react18 host åŸºç«™åœ°å€
  const mfhost = "https://emp-demo-react18-host.pages.dev/demos/react18/react-host/dist/emp.js"
  // react18 æ¡†æ¶åº“åœ°å€ 
  const frameworkLib = "https://unpkg.com/@empjs/libs-18@0.0.1/dist"
  return {
    plugins: [
      pluginReact(),
      pluginRspackEmpShare({
        empRuntime: {
          frameworkLib,
          frameworkGlobal: 'EMP_ADAPTER_REACT',
          framework: undefined, // è·¨ç‰ˆæœ¬è¿™é‡Œå¿…é¡»è¦é…ç½®ä¸º undefined
          // è¿œç¨‹æ¨¡å—åŠ è½½åº“è¿è¡Œæ—¶ moudle federation runtime
          runtimeLib: "https://unpkg.com/@empjs/share@3.1.2/output/full.js",
        },
      }),
    ],
    server: {port: 4002},
    define: {mfhost},
    debug: {clearLog: false, showRsconfig: 'x.json'},
  }
})
```

## æ ¸å¿ƒä»£ç 
```tsx title="src/App.tsx"
import React, { useEffect, useState, version } from 'react'
import ReactDOM from 'react-dom'
import { Card, CountComp as CountComp16, ShowCountComp as ShowCountComp16 } from './CountComp'
import './index.css'
import './normalize.css'
import { reactAdapter } from '@empjs/share/adapter'
import empRuntime from '@empjs/share/runtime'
const entry = process.env.mfhost as string
// å®ä¾‹åŒ–è¿œç¨‹ emp
empRuntime.init({
  shared: reactAdapter.shared,
  remotes: [
    {
      name: 'runtimeHost',
      entry,
    },
  ],
  name: 'federationRuntimeDemo',
})
// å°è£… React 18çš„ç»„ä»¶ ä»¥ä¾¿æ’å…¥åˆ° React 16
const React18App = reactAdapter.adapter(empRuntime.load('runtimeHost/App'))

// å°è£… React 16çš„ç»„ä»¶ ä»¥ä¾¿æ’å…¥åˆ° React 18
const ParentComponentAdepter = reactAdapter.adapter(CountComp16, 'default', React, ReactDOM)

const App = () => {
  return (
    <>
      <h1>App React Version {version}</h1>
      <ShowCountComp16 />
      <Card title="EMP From mfhost">
        <React18App>
          <ParentComponentAdepter />
        </React18App>
      </Card>
    </>
  )
}
export default App

```

:::tip
æ›´å¤šè¯¦æƒ…è§ [pluginRspackEmpShare](/plugin/tool/share) æ’ä»¶é…ç½®ã€‚
:::
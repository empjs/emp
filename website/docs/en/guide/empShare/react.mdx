import Preparation from '../../shared/preparation.md'
import { Tabs, Tab, PackageManagerTabs } from '@theme';

# React MF

åœ¨Reactä¸­ï¼Œæˆ‘ä»¬å‡†å¤‡äº†ä¸¤ä¸ªè¿›é˜¶ç¤ºä¾‹é¡¹ç›®ä½œä¸ºå‚è€ƒï¼Œåˆ†åˆ«æ˜¯ï¼š

- `runtime-18-host`ï¼šåŸºç¡€é¡¹ç›®ï¼Œç”¨äºä¹¦å†™é€šç”¨ä¸šåŠ¡ç»„ä»¶å¯¹å¤–æš´éœ²ï¼Œå®ƒé€šå¸¸æ˜¯ä¸€äº›é¡¹ç›®çš„åŸºçŸ³ã€‚
- `runtime-18-app`ï¼šåŸºç¡€é¡¹ç›®ï¼Œç”¨äºå’Œå…¶ä»–é€šç”¨ä¸šåŠ¡ç»„ä»¶è¿›è¡Œé›†æˆï¼Œå®ƒé€šå¸¸æ˜¯ä¸€äº›é¡¹ç›®çš„ä¸šåŠ¡é€»è¾‘ã€‚

è¯¦æƒ…å¦è§[é¡¹ç›®ä»“åº“](https://github.com/empjs/emp/tree/v3/demos/react18)

<Preparation />

### æ‹‰å–é¡¹ç›®ä»“åº“

```bash
git clone https://github.com/empjs/emp
```

:::danger ğŸš¨ å¯èƒ½é‡åˆ°çš„é”™è¯¯
å¦‚æœæ‚¨æ— æ³•æ‹‰å–é¡¹ç›®è‡³æœ¬åœ°ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œç¯å¢ƒæˆ–ä»£ç†è®¾ç½®æ˜¯å¦å¯ä»¥è®¿é—®githubï¼Œå¦‚æœä»ä¸èƒ½è§£å†³ï¼Œè¯·è”ç³»æˆ‘ä»¬ã€‚
:::

### å®‰è£…ä¾èµ–

<PackageManagerTabs command="install" />

å®‰è£…å®Œä¾èµ–åï¼Œè¿è¡Œ React ç¤ºä¾‹é¡¹ç›®çš„å‰æœŸå‡†å¤‡å°±å®Œæˆäº†ğŸ‰ã€‚

## è¿è¡Œç¤ºä¾‹é¡¹ç›®

:::warning âš ï¸ æ³¨æ„
åœ¨è¿è¡Œç¤ºä¾‹é¡¹ç›®ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²ç»å®Œæˆäº†å‰æœŸå‡†å¤‡ï¼Œå¹¶å½“å‰ç›®å½•å¤„äº`emp`ä»“åº“çš„æ ¹ç›®å½•ä¸‹ã€‚
:::

### React18 demo

é¦–å…ˆè¿›å…¥ç¤ºä¾‹é¡¹ç›®çš„æ ¹ç›®å½•ï¼š

```bash
cd demos/react18
```

ç„¶åè¿è¡Œä»£ç ï¼š
<PackageManagerTabs command="dev" />

è¿è¡ŒæˆåŠŸåï¼Œæ‚¨å¯ä»¥è®¿é—®`http://localhost:1801/`è¿›è¡ŒæŸ¥çœ‹ã€‚

:::warning âš ï¸ æ³¨æ„
è‹¥`1801`ç«¯å£è¢«å ç”¨ï¼Œé‚£ä¹ˆå¯åŠ¨çš„æœåŠ¡å¯èƒ½ä¼šä½¿ç”¨å…¶ä»–ç«¯å£ï¼Œè¯¦æƒ…è¯·ç•™æ„æ§åˆ¶å°çš„è¾“å‡ºæ—¥å¿—ã€‚
:::

#### æ¼”ç¤ºæ•ˆæœ

å½“æ‚¨çš„ä»£ç è¿è¡ŒæˆåŠŸä¹‹åï¼Œå®ƒåº”è¯¥æ˜¯è¿™æ ·å­çš„ğŸ¤©ï¼š<a target='_blank' href='https://emp-demo-react18-app.pages.dev/demos/react18/react-app/dist/'>è®¿é—®é“¾æ¥</a>

<iframe src="https://emp-demo-react18-app.pages.dev/demos/react18/react-app/dist/"
  style={{width: '100%', height: '200px', border: `20px solid #aaa`, borderRadius: '4px', overflow: 'hidden'}}
  title="mf-host"
></iframe>

## é…ç½®è®²è§£

## runtime-18-app

ç¤ºä¾‹é¡¹ç›®æ ¹ç›®å½•ï¼š

```bash
cd demos/react18/react-app
```

### EMPé¡¹ç›®é…ç½®

`emp.config.ts`é…ç½®å¦‚ä¸‹:
<iframe src="https://github1s.com/empjs/emp/blob/v3/demos/react18/react-app/emp.config.ts"
  style={{width: '100%', height: '800px', border: `20px solid #aaa`, borderRadius: '4px', overflow: 'hidden'}}
  title="emp.config.ts"
></iframe>

#### pluginRspackEmpShare plugins

`pluginRspackEmpShare` æ˜¯æ–°å¢çš„EMPæ’ä»¶ï¼Œä¸»è¦ç”¨æ¥é…ç½®Module Federation Runtimeçš„å…¬å…±ä¾èµ– `runtimeLib` ï¼Œä»¥åŠå…¬å…±çš„æ¡†æ¶ä¾èµ–`frameworkLib`ã€‚[æ’ä»¶è¯¦æƒ…](/plugin/tool/share)

#### build.polyfill.entryCdn

`EMP 3.1.5`åŠä»¥åç‰ˆæœ¬æ–°å¢ä¾èµ–ï¼Œè¿™é‡Œæä¾›é…ç½®åœ¨é¡µé¢å¤´éƒ¨åŠ è½½å…¼å®¹è¡Œè„šæœ¬ï¼Œä»¥ä¾¿`å‡å°‘å…¥å£åŒ…ä½“ç§¯`ä»¥åŠ`CDNç¼“å­˜å¤ç”¨`ã€‚[é…ç½®è¯¦æƒ…](/config/build/polyfill)

### è¿œç¨‹æ¨¡å—æ³¨å†Œä¸åŠ è½½

`src/App.tsx`ä»£ç å¦‚ä¸‹:
<iframe src="https://github1s.com/empjs/emp/blob/v3/demos/react18/react-app/src/App.tsx"
  style={{width: '100%', height: '800px', border: `20px solid #aaa`, borderRadius: '4px', overflow: 'hidden'}}
  title="src/App.tsx"
></iframe>

ä»£ç ä¸­åˆ†åˆ«å¼•å…¥`reactAdapter`ä¸ `@empjs/share/runtime`
```ts
import {reactAdapter} from '@empjs/share/adapter'
import rt from '@empjs/share/runtime'
```
é€šè¿‡ä½¿ç”¨ `@empjs/share/runtime` çš„ `init` ä¸ `register` å‡½æ•°ï¼Œè¾¾åˆ° `åˆå§‹åŒ–è¿œç¨‹æ¨¡å—` ä¸ `å¢é‡æ³¨å†Œè¿œç¨‹æ¨¡å—` çš„ç›®çš„ã€‚å…¶ä¸­ `reactAdapter` æä¾›äº† `module federation` å…±äº«çš„`share`é…ç½®ã€‚

æ³¨å†Œæ¨¡å—åï¼Œä½¿ç”¨ `@empjs/share/runtime` çš„ `load` å‡½æ•°ï¼ŒåŠ è½½æ¨¡å—ä¸­çš„ç»„ä»¶ï¼Œè¾¾åˆ°ä½¿ç”¨è¿œç¨‹æ¨¡å—çš„ç›®çš„ã€‚

:::tip
`@empjs/share/runtime` æä¾›äº†è¿œç¨‹æ¨¡å—è¿è¡Œæ—¶æ³¨å†Œçš„èƒ½åŠ›ï¼Œæ‰€ä»¥åœ¨ `emp.config.ts` ä¸­æ— éœ€å†ä½¿ç”¨ `module federation plugin` ã€‚å¦‚æœå½“å‰é¡¹ç›®ä¸éœ€è¦æš´éœ²è¿œç¨‹æ¨¡å—ï¼Œé‚£ä¹ˆå…¥å£çš„å¼‚æ­¥è¾¹ç•Œ`import()`ä¹Ÿå¯ä»¥ç§»é™¤ã€‚
:::

:::tip
æ›´å¤šè¯¦æƒ…è§ [pluginRspackEmpShare](/plugin/tool/share) æ’ä»¶é…ç½®ã€‚
:::